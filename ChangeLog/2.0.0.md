# Change Log: Version 2.0.0

**Release Date:** 2026-01-09

This is a **major release** that introduces a complete SMTP connectivity testing tool alongside the existing Microsoft Graph tool, restructures the codebase for better modularity, and removes the major version constraint.

## Breaking Changes

### Version Policy
- **Major Version Unlocked:** The major version is no longer locked at 1. Future releases will follow standard Semantic Versioning (x.y.z).
- **Reason:** The addition of a second tool and major architectural restructuring justify a major version bump.

### Build Process
- **New Build Location:** Tools are now built from `cmd/msgraphtool/` and `cmd/smtptool/` instead of `src/`.
- **Recommended Build Command:** Use `.\build-all.ps1` to build both tools at once.
- **Legacy Support:** Old build method (`go build -C src`) is deprecated but still works temporarily for backward compatibility.

## New Features

### SMTP Connectivity Testing Tool (`smtptool`)
A comprehensive SMTP testing tool that exceeds typical connectivity checks:

#### SMTP Actions
- **`testconnect`:** Basic SMTP connectivity with capability detection and Exchange server identification.
- **`teststarttls`:** Comprehensive TLS diagnostics including:
  - SSL/TLS handshake analysis
  - Certificate chain validation with full details (Subject, Issuer, SANs, expiry)
  - Cipher suite and strength assessment (strong/medium/weak)
  - Protocol version detection (TLS 1.0, 1.1, 1.2, 1.3)
  - Hostname verification and self-signed certificate detection
  - Warnings for deprecated protocols, weak ciphers, and expiring certificates
- **`testauth`:** SMTP authentication testing with auto-selection of mechanisms (PLAIN, LOGIN, CRAM-MD5).
- **`sendmail`:** End-to-end email sending with STARTTLS and authentication support.

#### SMTP Features
- **Exchange Detection:** Automatically detects on-premises Exchange servers (2003-2019) from banners and provides version-specific diagnostics.
- **CSV Logging:** All operations logged to `%TEMP%\_smtptool_{action}_{date}.csv`.
- **17 CLI Flags:** Comprehensive configuration including host, port, auth, TLS settings, email details.
- **Environment Variables:** All flags support `SMTP` prefix (e.g., `SMTPHOST`, `SMTPPORT`).
- **Bash/PowerShell Completion:** Auto-completion scripts for improved CLI experience.

## Architecture & Code Refactoring

### Modular Repository Structure
- **`cmd/` Directory:** Separate entry points for each tool:
  - `cmd/msgraphtool/` - Microsoft Graph tool (migrated from `src/`)
  - `cmd/smtptool/` - SMTP tool (new)
- **`internal/` Directory:** Shared packages with 70-80% code reuse:
  - `internal/common/logger/` - CSV and structured logging
  - `internal/common/retry/` - Retry with exponential backoff
  - `internal/common/version/` - Centralized version embedding
  - `internal/common/validation/` - Input validators
  - `internal/smtp/protocol/` - SMTP command builders and response parsing
  - `internal/smtp/tls/` - TLS handshake and certificate analysis
  - `internal/smtp/exchange/` - Exchange detection and diagnostics

### Microsoft Graph Tool Migration
- **Migrated to `cmd/msgraphtool/`:** All source files moved from `src/` to new location.
- **Updated Imports:** Now uses `internal/common/` packages for shared functionality.
- **No Functional Changes:** All existing features, flags, and behaviors remain identical.
- **Backward Compatible:** CSV logs, environment variables, and all actions work exactly as before.

## Build Infrastructure

### New Build Script (`build-all.ps1`)
- Builds both tools with a single command.
- Color-coded output with build status and binary sizes.
- Automatic version validation.
- Optional test skipping with `-SkipTests` flag.

### Updated Documentation
- **`BUILD.md`:** Completely rewritten with new cmd/ structure, cross-platform builds, troubleshooting guide.
- **`SMTP_TOOL_README.md`:** Comprehensive 500+ line documentation for SMTP tool with examples and CSV schemas.
- **`README.md`:** Updated to reflect dual-tool repository with usage examples for both tools.
- **`CLAUDE.md`:** Updated project documentation with new structure and versioning policy.
- **`RELEASE.md`:** Removed major version constraint, updated examples to use 2.x versioning.

## Dependencies

- **No New External Dependencies:** SMTP tool uses only Go standard library (`net`, `net/smtp`, `crypto/tls`, `crypto/x509`).
- **Maintains Minimal Dependencies:** Both tools remain portable single binaries with no runtime requirements.

## Technical Details

### SMTP Protocol Implementation
- **RFC 5321 Compliant:** Full SMTP command implementation with proper CRLF line endings.
- **Multiline Response Parsing:** Handles complex SMTP responses with continuation lines.
- **Error Classification:** Distinguishes 2xx (success), 4xx (temporary), 5xx (permanent) errors.
- **Authentication Mechanisms:** PLAIN, LOGIN, CRAM-MD5 with custom `loginAuth` implementation.
- **RFC 5322 Message Formatting:** Proper email message construction with Message-ID and Date headers.

### TLS/Certificate Analysis
- **Certificate Chain Walking:** Analyzes entire chain from leaf to root certificate.
- **Comprehensive Details:** Subject, Issuer, Serial, Valid dates, SANs, Key usage, Public key details.
- **Cipher Strength Assessment:** Categorizes cipher suites as strong, medium, or weak based on key size and algorithm.
- **Actionable Warnings:** Clear diagnostics for common issues (expiry, hostname mismatch, weak encryption).

### Exchange-Specific Features
- **Banner Detection:** Identifies "Microsoft ESMTP MAIL Service".
- **Version Mapping:** Maps build numbers to friendly names (Exchange 2013-2019).
- **Capability Analysis:** Detects Exchange-specific extensions (X-EXPS, XEXCH50, X-ANONYMOUSTLS).
- **Targeted Recommendations:** Provides Exchange-specific guidance based on detected version.

## Migration Guide

### For Users
1. **Update Build Commands:**
   - Old: `go build -C src -o msgraphgolangtestingtool.exe`
   - New: `.\build-all.ps1` or `go build -C cmd/msgraphtool -o msgraphgolangtestingtool.exe`

2. **No Changes Required for:**
   - Command-line flags and usage
   - Environment variables
   - CSV log locations and formats
   - All existing functionality

### For Developers
1. **Import Path Changes:**
   - Shared code moved to `internal/common/` packages
   - Use `msgraphgolangtestingtool/internal/common/logger` instead of local logger package

2. **Build from Project Root:**
   - `go build -C cmd/msgraphtool` for Graph tool
   - `go build -C cmd/smtptool` for SMTP tool

## Testing

- **Integration Tests:** All existing integration tests pass with migrated code.
- **Build Verification:** Both tools build successfully and display correct version (2.0.0).
- **Backward Compatibility:** All msgraphgolangtestingtool features verified working identically.

## Future Roadmap

With the version constraint removed and modular architecture in place:
- Future tools can be added to `cmd/` directory
- Shared functionality continues to live in `internal/common/`
- Each tool remains independently buildable and deployable
- Standard Semantic Versioning enables clear communication of breaking changes

---

**Full Changelog:** See individual commit messages and pull requests for detailed implementation history.

**Contributors:** This release represents a significant architectural evolution of the project while maintaining 100% backward compatibility for existing users.

                          ..ooOO END OOoo..

