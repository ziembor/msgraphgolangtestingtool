## [1.16.0] - 2026-01-04

### Added
- **Network Resilience with Exponential Backoff Retry Logic** (IMPROVEMENTS.md Recommendation #2)
  - `retryWithBackoff()` function implements intelligent retry wrapper for transient failures
  - `isRetryableError()` function detects which errors are safe to retry:
    - HTTP 429 (Too Many Requests / Graph API throttling)
    - HTTP 503 (Service Unavailable)
    - HTTP 504 (Gateway Timeout)
    - Network timeouts and connection issues
    - Never retries non-transient errors (authentication, bad requests, etc.)
  - Exponential backoff delay pattern: `baseDelay * 2^attempt`
    - Example: 2s → 4s → 8s → 16s → 30s (capped at 30 seconds)
  - Context cancellation support for graceful shutdown during retries
  - Detailed logging during retry attempts

- **Retry Configuration Options**
  - New Config struct fields:
    - `MaxRetries` (int) - maximum retry attempts (default: 3)
    - `RetryDelay` (time.Duration) - base delay between retries (default: 2000ms)
  - Command-line flags:
    - `-maxretries` - configure maximum retry attempts
    - `-retrydelay` - configure base delay in milliseconds
  - Environment variables:
    - `MSGRAPHMAXRETRIES` - set max retries via environment
    - `MSGRAPHRETRYDELAY` - set retry delay via environment
  - Help text updated with new flags and environment variable names

- **API Integration with Retry Logic**
  - `listEvents()` now uses retry logic for resilient calendar event retrieval
  - `listInbox()` now uses retry logic for resilient inbox message retrieval
  - Automatic retry on transient Graph API errors
  - Respects configured max retries and delay settings

- **Comprehensive Test Coverage**
  - 9 new test functions with 345 lines of test code:
    - `TestIsRetryableError()` - 17 test cases for error detection
    - `TestIsRetryableError_ODataErrors()` - wrapped error handling
    - `TestRetryWithBackoff_SuccessFirstTry()` - successful operation
    - `TestRetryWithBackoff_SuccessAfterRetries()` - recovery after failures
    - `TestRetryWithBackoff_MaxRetriesExceeded()` - retry exhaustion
    - `TestRetryWithBackoff_NonRetryableError()` - immediate failure for non-retryable errors
    - `TestRetryWithBackoff_ContextCancellation()` - graceful cancellation
    - `TestRetryWithBackoff_ExponentialBackoff()` - delay calculation verification
    - `TestRetryWithBackoff_DelayCap()` - 30-second delay cap verification
  - All 35 tests passing (24 existing + 11 new)
  - Test coverage validates both happy paths and edge cases

### Changed
- Updated `listEvents()` function to wrap Graph API call with retry logic
- Updated `listInbox()` function to wrap Graph API call with retry logic
- Enhanced error handling to differentiate between retryable and non-retryable failures

### Technical Details
- **Retry Implementation**: Closure-based retry wrapper separates retry logic from business logic
- **Error Detection**: Uses Go's `errors.As()` to unwrap error chains, catching both direct `azcore.ResponseError` and wrapped Graph SDK OData errors
- **Backoff Algorithm**: Exponential backoff with cap prevents excessive wait times while giving services time to recover
- **Thread Safety**: All retry operations are context-aware and support cancellation
- **Zero Breaking Changes**: Existing functionality unchanged, retry logic is opt-in via configuration
- **Backwards Compatible**: Default settings (3 retries, 2s delay) provide good balance of resilience and responsiveness

### Benefits
- **Improved Reliability**: Automatic recovery from transient network failures and API throttling
- **Production Ready**: Handles Graph API rate limiting (429) gracefully with exponential backoff
- **Configurable**: Users can tune retry behavior for their specific use cases
- **Observable**: Detailed logging shows retry attempts and success after retries
- **Resilient**: Reduces manual intervention for temporary service disruptions
- **Smart**: Only retries errors that are likely to succeed on retry, fails fast on permanent errors

### Performance Impact
- **No impact on successful operations**: Single API call when no errors occur
- **Minimal overhead**: Retry logic only activates on transient failures
- **Configurable delays**: Users can adjust retry delay based on their needs
- **Respect for APIs**: Exponential backoff prevents overwhelming services during outages

### Usage Examples
```powershell
# Use custom retry configuration
.\msgraphgolangtestingtool.exe -tenantid "..." -clientid "..." -secret "..." `
    -mailbox "user@example.com" -action getevents `
    -maxretries 5 -retrydelay 1000

# Via environment variables
$env:MSGRAPHMAXRETRIES = "5"
$env:MSGRAPHRETRYDELAY = "3000"
.\msgraphgolangtestingtool.exe -tenantid "..." -clientid "..." -secret "..." `
    -mailbox "user@example.com" -action getinbox

# Disable retries (set to 0)
.\msgraphgolangtestingtool.exe -maxretries 0 -action sendmail ...
```

### Files Modified
- `src/msgraphgolangtestingtool.go`:
  - Added `isRetryableError()` function (lines 754-810)
  - Added `retryWithBackoff()` function (lines 812-865)
  - Updated `listEvents()` with retry logic (lines 1015-1023)
  - Updated `listInbox()` with retry logic (lines 1311-1319)
  - Added retry configuration flags (lines 410-411)
  - Added environment variable handling (lines 462-490)
  - Added Config fields for MaxRetries and RetryDelay (lines 105-106)
- `src/msgraphgolangtestingtool_test.go`:
  - Added 9 new test functions (lines 732-1076)
  - Added imports for context, errors, fmt, azcore
- `src/VERSION`: Updated to 1.16.0

### Migration Notes
- No migration required - feature is fully backwards compatible
- Default retry settings (3 retries, 2s delay) are automatically applied
- Users can customize retry behavior via command-line flags or environment variables
- Existing scripts and automation will continue to work without changes
