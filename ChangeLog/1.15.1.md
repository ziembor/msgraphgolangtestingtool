## [1.15.1] - 2026-01-04

### Changed
- **Refactored large run() function into focused helper functions** (IMPROVEMENTS.md Code Quality #4.1)
  - Reduced run() function from 190 lines to 38 lines (80% reduction)
  - Extracted 6 specialized helper functions with single responsibilities:
    - `setupSignalHandling()` - Configures graceful shutdown on interrupt signals
    - `parseAndConfigureFlags()` - Defines flags, parses them, applies environment variables
    - `validateConfiguration()` - Validates required parameters and auth method exclusivity
    - `initializeServices()` - Sets up CSV logging and proxy configuration
    - `setupGraphClient()` - Creates credentials and initializes Graph SDK client
    - `executeAction()` - Dispatches to appropriate action handler
  - Improved code organization following Single Responsibility Principle
  - Enhanced testability - each function can now be unit tested independently
  - Better maintainability - changes are localized to specific functions
  - Clearer code flow - run() now reads like a table of contents

### Added
- **Flags struct** - Centralized container for all command-line flag values
  - 18 fields organized by category (core, authentication, email, calendar, network)
  - Passed between helper functions instead of individual parameters
  - Simplifies function signatures and improves type safety
  - Foundation for future input validation enhancements

- **Enhanced configuration validation**
  - Validates required parameters: TenantID, ClientID, Mailbox
  - Enforces mutual exclusivity of authentication methods
  - Clear error messages for missing or conflicting parameters
  - Prevents invalid configurations before API calls

- **Comprehensive unit test suite** (IMPROVEMENTS.md Testing #6.1)
  - Created `src/msgraphgolangtestingtool_test.go` with 7 test functions
  - Total of 42 individual test cases covering core functionality
  - Tests for `stringSlice` custom type (Set and String methods)
  - Tests for `createRecipients()` helper function
  - Tests for `maskSecret()` security function
  - Tests for `validateConfiguration()` with 9 validation scenarios
  - Tests for `Flags` and `Config` struct initialization
  - All tests passing with 7.5% code coverage
  - Foundation for regression testing and confident refactoring
  - Follows table-driven test pattern (Go best practice)

- **Enhanced help output with repository link**
  - Customized `-help` output to include GitHub repository URL
  - Added version information to help header
  - Included environment variables documentation section
  - Added usage examples in help output
  - Repository link: https://github.com/ziembor/msgraphgolangtestingtool
  - Help automatically displays on validation errors

- **Documentation updates**
  - Added GitHub repository link to README.md
  - Added GitHub repository link to CLAUDE.md
  - Improved discoverability of source code

- **Input validation functions** (IMPROVEMENTS.md Code Quality #4.3)
  - Added `validateEmail()` - validates email format with @ symbol check
  - Added `validateEmails()` - validates slices of email addresses
  - Added `validateGUID()` - validates GUID format (36 chars, proper dash positions)
  - Added `validateRFC3339Time()` - validates RFC3339 timestamp format
  - Enhanced `validateConfiguration()` to use validation helpers
  - Validates Tenant ID and Client ID as proper GUIDs
  - Validates Mailbox and recipient emails for proper format
  - Validates calendar invite times (start/end) if provided
  - Validates action against allowed values (getevents, sendmail, sendinvite, getinbox)
  - Clear, helpful error messages before making API calls
  - Prevents wasted API calls with invalid data

- **CSV buffering optimization** (IMPROVEMENTS.md Performance #5.1)
  - Added periodic flush instead of flush-on-every-write
  - CSV logger now flushes every 10 rows OR every 5 seconds
  - Added `rowCount`, `lastFlush`, and `flushEvery` fields to CSVLogger
  - Reduces I/O operations for high-volume scenarios
  - Close() method ensures all buffered data is flushed
  - No data loss - all rows guaranteed to be written
  - Minimal impact on current low-volume usage
  - Improved performance for batch operations

- **Expanded test suite for input validation**
  - Added `TestValidateEmail()` - 10 test cases
  - Added `TestValidateEmails()` - 4 test cases
  - Added `TestValidateGUID()` - 7 test cases
  - Added `TestValidateRFC3339Time()` - 7 test cases
  - Added `TestValidateConfigurationEnhanced()` - 6 test cases
  - Total test functions increased from 7 to 12
  - Total test cases increased from 42 to 82 (including subtests)
  - Code coverage increased from 7.5% to 12.8% (+71% improvement)
  - All tests passing

- **Comprehensive documentation** (IMPROVEMENTS.md Documentation #7.1, #7.2)
  - Created **TROUBLESHOOTING.md** (15KB) - Error troubleshooting guide
    - Authentication errors (invalid credentials, cert issues, Azure AD errors)
    - Permission errors (insufficient privileges, access denied)
    - Network/proxy errors (timeouts, proxy misconfiguration)
    - CSV logging issues (permissions, file locks)
    - Input validation errors (GUID format, email format, RFC3339 times)
    - Common usage errors (event creation, email delivery)
    - Verbose mode debugging guide
  - Created **SECURITY_PRACTICES.md** (20KB) - Security best practices guide
    - Credential management (secrets, certificates, environment variables)
    - Least privilege principle and API permissions
    - Application access policies to restrict mailbox access
    - Logging, auditing, and monitoring strategies
    - Network security (proxy usage, TLS/SSL)
    - Access control and operational security
    - Incident response procedures
    - Compliance (GDPR, HIPAA, SOC 2, ISO 27001)
    - Security checklist for production deployment
  - Updated README.md to reference new documentation files

### Technical Details
- run() function now has 7 clear steps with inline documentation
- Each helper function has focused responsibility (12-117 lines each)
- All existing functionality preserved - no breaking changes
- Build tested successfully with version display and validation
- Unit tests implemented and passing (IMPROVEMENTS.md #6.1 ✅ complete)
- Input validation implemented (IMPROVEMENTS.md #4.3 ✅ complete)
- CSV buffering optimization implemented (IMPROVEMENTS.md #5.1 ✅ complete)
- Documentation enhancements implemented (IMPROVEMENTS.md #7.1, #7.2 ✅ complete)
- Test suite uses table-driven tests for comprehensive edge case coverage
- Code coverage improved significantly: 7.5% → 12.8% (+71% relative improvement)
- 82 test cases across 12 test functions (including subtests)
- Run tests with: `go test -v ./src` or `go test -cover ./src`
- IMPROVEMENTS.md updated: 6 out of 9 optional enhancements now complete (67%)
